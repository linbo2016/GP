<!DOCTYPE html>

<html>

<head>
<style>
#info {
  position: absolute;
  top: 0px;
  width: 100%;
  padding: 10px;
  text-align: center;
  color: #ffff00
}

body {
  overflow: hidden;
}

</style>
</head>

<body> 

<div id="info">Hw5</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/84/three.min.js"></script>
<script src="https://threejs.org/examples/js/controls/OrbitControls.js"></script>
<script src="https://jyunming-chen.github.io/game3js/js/ccdsys.js"></script>
<script src="js/MD2CharacterComplex.js"></script>
<script src="js/MD2Loader.js"></script>
<script src="js/MorphBlendMesh.js"></script>

<script>

var camera, scene, renderer, wrap;
var clock = new THREE.Clock();

class MD2Wrapper{
            constructor (config, controls, pos, scale = 1) {

                this.md2 = new THREE.MD2CharacterComplex();
                this.md2.scale = scale;
                this.md2.controls = controls;

                this.md2.onLoadComplete = function () {
                    // here: 'this' is md2

                    // cast and receive shadows
                    this.enableShadows( true );

                    this.setWeapon( 0 );
                    this.setSkin( 0 );

                    //this.root.position.copy (pos);
                    this.root.position.x = pos.x;
                    this.root.position.z = pos.z;

                    // y is automatically set, accoording to scale ...
                    console.log ('y is ' + this.root.position.y);
                    scene.add( this.root );
                    people.defaultY = this.root.position.y;

                };
                this.md2.loadParts( config );

            }
        }


init();
animate();

function init() {
    scene = new THREE.Scene();

    camera = new THREE.PerspectiveCamera(50, window.innerWidth / window.innerHeight, 1, 1000);
    camera.position.z = 200;
    camera.position.y = 150;
    light = new THREE.PointLight(0xffffff);
    light.position.set(100, 300, 200);
    scene.add(light);



    renderer = new THREE.WebGLRenderer();
    renderer.setSize(window.innerWidth, window.innerHeight);
    renderer.setClearColor(0x888888);

    controls = new THREE.OrbitControls(camera, renderer.domElement);

    document.body.appendChild(renderer.domElement);
    ///////////////////////////////////////////////////////////
	
	scene.add(new THREE.GridHelper(500,50,'red','white'));
	
	let config = {
		baseUrl: "model/",
		body: "Tris.md2",
		skins: ["mario2.png"],
		weapons: [],
		animations: {
			move: "run",
			idle: "stand",
			attack: "attack",
			jump: "jump",
			crouchIdle: "crstand",
			crouchMove: "crwalk",
			crouchAttach: "crattack"
		},

		walkSpeed: 150,
		crouchSpeed: 75
	};
	let control = {
		moveForward: false,
		moveBackward: false,
		moveLeft: false,
		moveRight: false
	};
	
	wrap = new MD2Wrapper(config,control,new THREE.Vector3(),1);
	
	////////////////////////////////////////////////////////////
}


function animate() {

	let dt = clock.getDelta();
	wrap.md2.update(dt);

    requestAnimationFrame(animate);
    render();
}

function render() {
    renderer.render(scene, camera);
}



</script>
</body>

</html>